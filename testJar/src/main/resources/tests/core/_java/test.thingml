import "../test.thingml"

object Dumper
@java_type "org.thingml.devices.Dumper";

thing TestDumpJava includes TestDump
@thingml_maven_dep "org.thingml.samples.utils"
{
    readonly property device : Dumper = 'new org.thingml.devices.Dumper()'

	function write(string : String)
	do
    	'((org.thingml.devices.Dumper)' & device & ').write(' & string & ');'
    	print(string)
	end

	statechart JavaHarness init Testing {
		state Testing {

            internal event m : dump?testOut
            action do
                write('Character.toString('&m.c&')')
            	transitionsCount=transitionsCount+1
            end

            transition -> Failed
            event dump?testFailure

            transition -> End
            event dumpEnd?testEnd
		}

		final state Failed {
			on entry do
			    write("*FAILURE*")
			    'System.exit(-1);'
			end
		}

		final state End {
			on entry do
				print(" [Done]\n End of thingml processus")
				'System.exit(0);'
			end
		}
	}
}
